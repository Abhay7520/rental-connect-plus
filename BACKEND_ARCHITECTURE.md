# Backend Architecture & Integration Guide

This document explains how the **Rental Connect Plus** application was refactored from a serverless architecture (Firebase) to a robust **MERN Stack** (MongoDB, Express, React, Node.js) application.

## 1. Backend Setup (`renteazy-backend`)

The backend is built using **Node.js** and **Express.js**. It serves as the REST API that the frontend communicates with.

### Key Components:
*   **`server.js`**: The entry point of the backend. It:
    *   Initializes the Express app.
    *   Connects to MongoDB.
    *   Configures **CORS** (Cross-Origin Resource Sharing) to allow the frontend (running on port 8080 or 5173) to talk to the backend (port 8080).
    *   Registers API routes (e.g., `/api/properties`, `/api/users`).
*   **`models/`**: Defines the structure of data using **Mongoose** schemas.
    *   Example: `Property.js` defines that a property must have a `title`, `price`, `owner_id`, etc.
*   **`routes/`**: Handles specific API endpoints.
    *   Example: `propertyRoutes.js` handles `GET /`, `POST /`, `PUT /:id`, and `DELETE /:id` for properties.

## 2. Database Storage (MongoDB)

We use **MongoDB**, a NoSQL database, to store data as JSON-like documents. **Mongoose** is used as an Object Data Modeling (ODM) library to interact with MongoDB.

### How Data is Stored:
1.  **Collections**: Data is grouped into collections (like tables in SQL). We have collections for `users`, `properties`, `bookings`, `issues`, etc.
2.  **Documents**: Each item (e.g., a single property) is a document.
3.  **Relationships**: We link data using IDs.
    *   *Example*: A `Booking` document has a `property_id` (linking to a Property) and a `tenant_id` (linking to a User).

## 3. Frontend-Backend Connection

The frontend (React) connects to the backend using HTTP requests. This logic is centralized to keep the code clean.

### The Bridge: `src/services/apiService.ts`
This file is the single point of contact for the backend.
*   It defines functions like `PropertyService.getAll()`, `BookingService.create()`, etc.
*   It uses the native `fetch` API to send requests to `http://localhost:8080/api/...`.
*   **Polling**: Since we removed Firebase real-time listeners, we implemented a "polling" mechanism. The frontend asks the backend for new data every 2 seconds (`createPoller`) to simulate real-time updates.

### State Management: Contexts
React Contexts (`PropertyContext.tsx`, `AuthContext.tsx`) use the `apiService` to fetch data and make it available to components.
*   **Normalization**: The backend uses `_id` (MongoDB default), but the frontend expects `id`. The contexts handle this mapping (e.g., `normalizeProperty` function).

## 4. Data Flow Example: Creating a Property

Here is the step-by-step process of what happens when a user adds a property:

1.  **User Action**: User fills out the form in `AddProperty.tsx` and clicks "Submit".
2.  **Frontend Context**: `AddProperty.tsx` calls `addProperty(data)` from `PropertyContext`.
3.  **Data Mapping**: `PropertyContext` prepares the data.
    *   It maps frontend field `rent_price` to backend field `price`.
    *   It ensures `owner_id` is attached.
4.  **API Call**: `PropertyContext` calls `PropertyService.create(data)`.
5.  **Network Request**: `apiService` sends a `POST` request to `http://localhost:8080/api/properties` with the JSON data.
6.  **Backend Route**: `propertyRoutes.js` receives the request.
7.  **Database Operation**: Mongoose creates a new `Property` document and saves it to MongoDB.
8.  **Response**: The backend sends back the created property object (including the new MongoDB `_id`).
9.  **UI Update**:
    *   `PropertyContext` receives the response.
    *   It updates the local `properties` state array immediately (Optimistic UI).
    *   The Poller eventually confirms the data is on the server.

## 5. How to Run

1.  **Start Database**: Ensure MongoDB is running.
2.  **Start Backend**:
    ```bash
    cd renteazy-backend
    npm start
    ```
    (Runs on `http://localhost:8080`)
3.  **Start Frontend**:
    ```bash
    # In a new terminal
    npm run dev
    ```
    (Runs on `http://localhost:8080` via Vite proxy or similar port)

---
*Generated by Antigravity*
